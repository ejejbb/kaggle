# 1. 캐글 필사: New York Taxi Trip Duration

## 대회 소개
> 🗽 뉴욕시 택시 승차 기록 데이터를 기반으로 택시 이동 시간(trip duration)을 예측하는 문제
- 문제 유형: 회귀(Regression)
- 컬럼 설명
```
id: 고유한 식별자

vendor_id: 택시 회사 ID

pickup_datetime: 승차 시간

dropoff_datetime: 하차 시간

passenger_count: 승객 수

pickup_longitude, pickup_latitude: 승차 위치

dropoff_longitude, dropoff_latitude: 하차 위치

store_and_fwd_flag: 데이터가 즉시 전송되었는지 여부

trip_duration: 단위는 초 (target)
```
- 🔍 참가자들이 사용하는 주요 기술들
```
거리 계산: Haversine formula를 사용하여 두 지점 간 거리 계산

시간 특징 추출: 요일, 시간대 등으로 pickup_datetime을 분해

외부 데이터 활용: 날씨, 교통량 등의 정보 추가

모델: XGBoost, LightGBM, Random Forest, Neural Network 등
```

### Haversine 거리
> 지구의 곡률을 고려한 구면 거리 계산 방식

![alt text](/kaggle_study/image/image30.png)

ϕ: 위도 (radian)   
λ: 경도 (radian)   
r: 지구 반지름 (약 6371km)

## ✅ 목적
> XGBoost 모델 성능을 높이기 위한 피쳐 엔지니어링

### 데이터 이해하기
데이터 자체에 큰 오류가 없는지 확인하고, 타깃변수를 로그변환

### 피쳐 선택 - PCA
```
pickup/dropoff 좌표는 대체로 대각선 방향(↘, ↖)으로 분포되어 있음.

트리 모델은 수직( | ) 또는 수평(—) 기준으로 나누기 때문에, 대각선으로 퍼진 데이터를 잘 자르려면 여러 split이 필요함 (비효율)

👉 PCA로 축을 회전시켜 대각선을 x축 정렬처럼 바꿔주면 →
트리 모델이 단순한 조건으로 나눌 수 있음
```
#### 거리
`haversine 거리`를 이용해 계산

#### 평균 속도
시간대별 평균 속도
![alt text](/kaggle_study/image/image31.png)

지역별 평균 속도
![alt text](/kaggle_study/image/image32.png)

#### 클러스터링
```python
sample_ind = np.random.permutation(len(coords))[:500000] ## 무작위로 50만 개 좌표 샘플 추출

kmeans = MiniBatchKMeans(n_clusters=100, batch_size=10000).fit(coords[sample_ind])
# MiniBatchKMeans: 일반 KMeans보다 빠르게 동작하는 대용량 최적화 버전
# n_clusters=100: 총 100개의 지역 구역으로 나눔
## 소수점 3자리 기준 좌표로 나누면 약 100~200개의 클러스터가 적절한 해상도를 가진다고 한다.
## 100개 정도는 LightGBM, XGBoost, CatBoost 등 트리 기반 모델에서 잘 처리 가능한 범위
```
![alt text](/kaggle_study/image/image33.png)